<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Petronas Twin Towers – WebAR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />

  <!-- model-viewer (Web Component) -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

  <style>
    :root { color-scheme: dark; }
    html, body { height:100%; margin:0; background:#0b0d12; color:#eaf1ff; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
    .wrap { min-height:100%; display:flex; flex-direction:column; }
    header, footer { text-align:center; padding:16px 12px; }
    main { flex:1; display:flex; align-items:center; justify-content:center; padding:16px; }
    .card { width:100%; max-width:760px; background:#141822; border:1px solid #23293a; border-radius:16px; padding:16px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    model-viewer { width:100%; height:60vh; background:#0b0d12; border-radius:12px; }
    .cta { margin-top:12px; display:flex; gap:12px; flex-wrap:wrap; justify-content:center; }
    button {
      appearance:none; border:0; padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:600;
      background:#2b91ff; color:white;
    }
    button.secondary { background:#23293a; color:#dfe7ff; }
    .hint { text-align:center; font-size:14px; opacity:0.85; margin-top:6px; }
    .status { margin-top:12px; font-size:13px; background:#0f1320; border:1px solid #23293a; border-radius:10px; padding:10px; line-height:1.35; }
    .ok { color:#b6f0c4; } .bad { color:#ffb3b3; }
    a, a:visited { color:#8ec7ff; text-decoration: none; }
    code { background:#0f1320; padding:2px 6px; border-radius:6px; border:1px solid #23293a; }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Petronas Twin Towers – Augmented Reality</h1>
    <div style="opacity:.8">
      URL (Pages): <code>https://dhukanestapha.github.io/kl-ar/</code>
    </div>
  </header>

  <main>
    <div class="card">
      <!-- IMPORTANT:
           Put your models here in the repo:
           kl-ar/assets/petronas_twin_tower.glb
           kl-ar/assets/PETRONAS_TWIN_TOWER.usdz
           (optional) kl-ar/assets/poster.jpg
      -->
      <model-viewer id="viewer"
        src="assets/petronas_twin_tower.glb"
        ios-src="assets/PETRONAS_TWIN_TOWER.usdz"
        ar
        ar-modes="scene-viewer quick-look webxr"
        ar-scale="fixed"
        ar-placement="floor"
        camera-controls
        exposure="1.1"
        shadow-intensity="0.9"
        disable-tap
        poster="assets/poster.jpg"
        alt="KL Petronas Twin Towers 3D model">
      </model-viewer>

      <div class="cta">
        <button id="arBtn">View in AR</button>
        <button class="secondary" id="resetBtn">Reset view</button>
      </div>
      <div class="hint">If AR doesn’t start, move the phone to detect the floor. iOS uses Quick Look; Android uses Scene Viewer.</div>

      <!-- Live diagnostics so 404s are obvious -->
      <div class="status" id="statusBox">
        <div><strong>Diagnostics</strong></div>
        <div>GLB: <span id="glbStatus">checking…</span></div>
        <div>USDZ (iOS): <span id="usdzStatus">checking…</span></div>
        <div>Poster: <span id="posterStatus">checking…</span></div>
      </div>
    </div>
  </main>

  <footer>
    © You • KL Twin Towers AR • Host: GitHub Pages • Files are case-sensitive
  </footer>
</div>

<script>
  const viewer = document.getElementById('viewer');
  const arBtn = document.getElementById('arBtn');
  const resetBtn = document.getElementById('resetBtn');

  arBtn.addEventListener('click', () => {
    if (viewer.canActivateAR) viewer.activateAR();
    else alert('AR not supported on this device/browser.');
  });

  resetBtn.addEventListener('click', () => {
    viewer.cameraOrbit = 'auto';
    viewer.cameraTarget = 'auto';
    viewer.resetTurntableRotation();
  });

  // --- Diagnostics: verify assets exist to avoid silent 404s ---
  const checks = [
    { id: 'glbStatus', path: 'assets/kl-twin-towers.glb' },
    { id: 'usdzStatus', path: 'assets/kl-twin-towers.usdz' },
    { id: 'posterStatus', path: 'assets/poster.jpg' }
  ];

  async function check(url, el) {
    try {
      // HEAD is ideal, but some hosts block it; fall back to GET if needed
      let res = await fetch(url, { method: 'HEAD' });
      if (!res.ok) res = await fetch(url, { method: 'GET', cache: 'no-store' });
      if (res.ok) {
        el.innerHTML = '<span class="ok">OK</span> (' + url + ')';
      } else {
        el.innerHTML = '<span class="bad">NOT FOUND</span> (' + url + ')';
      }
    } catch (e) {
      el.innerHTML = '<span class="bad">ERROR</span> (' + url + ')';
    }
  }

  for (const c of checks) {
    const el = document.getElementById(c.id);
    check(c.path, el);
  }
</script>
</body>
</html>
